{"version":3,"sources":["util.ts","config.ts","网页笔记.ts"],"names":[],"mappings":"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","file":"网页笔记.js","sourceRoot":"..\\网页笔记","sourcesContent":["/** 用于复制文本的input */\r\nconst input_copy = document.createElement('input')\r\ninput_copy.id='__'\r\n// input_copy.style.display='none'//不能设置为none因为会导致没有可访问性\r\ninput_copy.setAttribute('style', `\r\n        position: absolute;\r\n        top: -9999px;\r\n        left: -9999px;`)\r\ndocument.body.appendChild(input_copy)\r\n\r\n/** 工具类 */\r\nexport default {\r\n    /** 复制一个元素的titil 或者一段字符串到剪贴板 */\r\n    copyTitle(el: HTMLElement | string) {\r\n        let title\r\n        if (typeof el === 'string')\r\n            title = el\r\n        else\r\n            title = el.getAttribute(\"title\");\r\n\r\n        input_copy.setAttribute('readonly', 'readonly');\r\n        input_copy.setAttribute('value', title);\r\n        input_copy.select();\r\n        input_copy.setSelectionRange(0, 9999);\r\n        document.execCommand('copy')\r\n    }\r\n}","export default {\r\n    state: 0,\r\n    elemtEdit: location.href.includes('127.0.0.1'),//默认127.0.0.1是开发环境自动开启\r\n}","import $ from \"./util\";\r\nimport config from \"./config\";\r\n\r\n\"use strict\";\r\n// ==UserScript==\r\n// @name         网页文本编辑,做笔记的好选择\r\n// @namespace    http://tampermonkey.net/\r\n// @version      0.18\r\n// @description  所见即所得！\r\n// @author       You\r\n// @match        *\r\n// @include      *\r\n// @grant        GM_getValue    //油猴的存储接口\r\n// @grant        GM_setValue\r\n// ==/UserScript==\r\n(function () {\r\n    'use strict';\r\n    //为了在非油猴环境下存储依旧能起一部分的作用\r\n    if (window.hasOwnProperty(\"GM_getValue\") && window.hasOwnProperty(\"GM_setValue\")) {\r\n        localStorage.getItem = (<any>window).GM_getValue;\r\n        localStorage.setItem = (<any>window).GM_setValue;\r\n    }\r\n\r\n    /** 存储鼠标所在位置的所有元素 */\r\n    let path:HTMLElement[];\r\n    /** 监听鼠标移动 */\r\n    function mouse(event:Event) {\r\n        if (event.target instanceof HTMLElement) {\r\n            path = nodePath(event.target);\r\n            outline(event.target);\r\n        }\r\n    }\r\n    if(config.elemtEdit){\r\n        document.addEventListener('mouseover', mouse);\r\n    }\r\n\r\n    //监测按键事件\r\n    document.addEventListener('keydown', function (event) {\r\n        var code = event.code;\r\n        if (code === 'F2') {\r\n            config.elemtEdit = !config.elemtEdit;\r\n            console.log('切换编辑状态', config.elemtEdit );\r\n            if (config.elemtEdit) //不处于编辑状态则移除鼠标监听事件，降低性能的消耗\r\n                document.addEventListener('mouseover', mouse);\r\n            else\r\n                document.removeEventListener(\"mouseover\", mouse);\r\n            event.preventDefault();\r\n            event.returnValue = false;\r\n            return false;\r\n        }\r\n        //有元素获得焦点，视为正在输入文本，不执行下面的功能\r\n        if (document.querySelectorAll(\":focus\").length > 0) {\r\n            return;\r\n        }\r\n        switch (code) {\r\n            case 'KeyQ':\r\n                editSelect(path[0]);\r\n                break;\r\n            case 'KeyD':\r\n                console.log(new deleteSelect(path[0]));\r\n\r\n                break;\r\n            case 'KeyC':\r\n                $.copyTitle(path[0])\r\n                if(event.ctrlKey===false)//因为ctrl+c不应该被阻止\r\n                    break\r\n            case \"KeyW\":\r\n                path[0].contentEditable = 'false';\r\n                break;\r\n            default:\r\n                return true;\r\n        }\r\n    });\r\n\r\n    /** 元素失去焦点 */\r\n    document.addEventListener('focusout',function(){\r\n        console.log(event.target);\r\n\r\n    })\r\n\r\n    /** 设置元素可编辑并获取 逐级向上获取titile*/\r\n    function editSelect(selectElem:HTMLElement) {\r\n        selectElem.contentEditable = 'true';\r\n        $.copyTitle(selectElem)\r\n    }\r\n\r\n\r\n    /** 轮廓线,用以显示当前元素 */\r\n    function outline(elemt:HTMLElement) {\r\n        if (elemt.style.outline == \"2px solid red\")\r\n            return;\r\n        elemt.style.outline = \"2px solid red\";\r\n        setTimeout(function () {\r\n            if (elemt == path[0]) {\r\n                outline(elemt);\r\n                return;\r\n            }\r\n            elemt.style.outline = \"\";\r\n        }, 400);\r\n    }\r\n    /** 获取一个元素的所有父节点到html为止 */\r\n    function nodePath(...path:HTMLElement[]) {\r\n        while (path[path.length-1].parentElement != null) {\r\n            path.push(path[path.length - 1].parentElement);\r\n        }\r\n        return path;\r\n    }\r\n})();\r\n/*\r\n# 使网页可编辑\r\n* 按下F2启用元素编辑，再次按下可以关闭\r\n* 将鼠标移动到你要修改的文本上方 按下 q 就会将该元素设为可编辑，并且复制它的title到剪贴板中\r\n*                           按下 w 设置元素为不可编辑\r\n*                           按下 d 就会删除该元素\r\n*                           按下 c 会将元素的title（一般为该元素描述）复制到剪贴板（如果存在的话）\r\n* 注意！在元素获得焦点（一般是你在输入文本的时候）的情况下，上面这些按键将进行正常的输入\r\n* 对本地打开的网页的修改 需要在浏览器中设置允许插件在文件地址上运行\r\n\r\n## 为什么要开发这样一个插件?\r\n* 这源于我一次在看mdn文档时,想要做笔记,正打算和以前一样将网页复制进word中添加笔记等等\r\n* 突然察觉我为什么要多此一举?\r\n* 直接在网页中写笔记不好吗\r\n* 所以有了这个插件,你可以利用这个插件来修改网页上的文本,然后按下ctrl+s将这些改动永久保存在本地\r\n* 建议允许插件在文件地址上运行\r\n* 正在想方法让笔记存在云端\r\n\r\n## v0.19 的更新介绍\r\n* 最近得空了，开始更新\r\n* 因为（ctrl + 其他键）的模式 在一些浏览器上还是会出现冲突，故改为F2键来作为开关\r\n* 下一版本将实现便签功能，以及撤销功能\r\n* 正在进行云端存储的后台工作。在不远的将来将实现笔记备份至云端\r\n* 希望各位能将你们想要的功能进行一个反馈\r\n*/"]}